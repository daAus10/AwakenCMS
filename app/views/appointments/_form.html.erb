<%= form_with(model: appointment) do |form| %>

  <% if appointment.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(appointment.errors.count, "error") %> prohibited this appointment from being saved:</h2>

      <ul>
        <% appointment.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form.hidden_field :kart_id, value: @kart.id %>

  <div class="field">
    <%= form.label "Select a preferred time for Time " %>
    <br>
    <% morning_times = ['9:00am', '10:00am', '11:00am'] %>
    <% afternoon_times = ['1:00pm', '2:00pm', '3:00pm'] %>
    <% evening_times = ['4:00pm', '5:00pm', '5:30pm', '6:00pm'] %>


    <h3>Morning</h3>
    <% morning_times.each do |time| %>
      <% disabled = @taken_time_slots.include?(time) %>
      <label class="custom-radio <%= 'disabled' if disabled %>" for="time-<%= time %>">
        <%= form.radio_button :time, time, id: "time-#{time}", onchange: "disableSelectedTime(this); toggleSubmitButton()", disabled: disabled, style: "display: none;" %>
        <%= disabled ? 'N/A' : time %>
      </label>
      <%#= form.radio_button :time1, time, id: "time1-#{time}", onchange: "disableSelectedTime(this)", disabled: @appointments.include?(time)  %> <%#= time %>
    <% end %>
    <h3>Afternon</h3>
    <% afternoon_times.each do |time| %>
      <% disabled = @taken_time_slots.include?(time) %>
      <label class="custom-radio <%= 'disabled' if disabled %>" for="time-<%= time %>">
        <%= form.radio_button :time, time, id: "time-#{time}", onchange: "disableSelectedTime(this); toggleSubmitButton()", disabled: disabled, style: "display: none;" %>
        <%= disabled ? 'N/A' : time %>
      </label>
    <% end %>
    <h3>Evening</h3>
    <% evening_times.each do |time| %>
      <% disabled = @taken_time_slots.include?(time) %>
      <label class="custom-radio <%= 'disabled' if disabled %>" for="time-<%= time %>">
        <%= form.radio_button :time, time, id: "time-#{time}", onchange: "disableSelectedTime(this); toggleSubmitButton()", disabled: disabled, style: "display: none;" %>
        <%= disabled ? 'N/A' : time %>
      </label>
    <% end %>

    <table class="appt_form">
  </div>
  <h3 class="apt_title">Appointment Form</h3>
  <div class="input-container">
    <%= form.label :name, style: "display: block" %>
    <%= form.text_field :name %>
  </div>

  <div class="input-container">
    <%= form.label :phone, style: "display: block" %>
    <%= form.text_field :phone %>
  </div>

  <div class="input-container">
    <%= form.label :date, style: "display: block" %>
    <%= form.date_field :date %>
  </div>

  <div class="input-container">
    <%= form.label :email, style: "display: block" %>
    <%= form.text_field :email %>
  </div>

  <div class="input-container">
    <%= form.label :special_needs, style: "display: block" %>
    <%= form.text_area :special_needs %>
  </div>


  <h3>Services Details:</h3>
  <table>
    <thead>
    <tr>
      <th>Name</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>Total</th>
    </tr>
    </thead>
    <tbody>
    <% @appointment.orderables.each do |orderable| %>
      <% product = orderable.product %>
      <tr>
        <td><h2></h2><%= product.name %></td>
<!--        <td><%#= orderable.quantity %></td>-->
        <td><%= product.price %></td>
<!--        <td><%#= orderable.total %></td>-->
      </tr>
    <% end %>
    </tbody>
  </table>



  <div class="field">
    <%= form.check_box :terms_accepted, id: "terms_accepted", onchange: "toggleSubmitButton(this)" %>
    <%= form.label :terms_accepted, "Before submitting, you agree to the" %>
    <%= link_to "Terms and Conditions", "https://example.com/terms_and_conditions", target: "_blank", rel: "noopener noreferrer" %>
  </div>


  <div class="actions">
    <%= form.submit "Submit", disabled: true %>
  </div>
<% end %>
</table>


<style>
  .appt_form {
      border-color: #2E2F30;
  }

  .apt_title { align-self: center}
    /* Custom radio button styles */
    .input-container {
        display: table;
        width: 45%; /* Optional: Set a width to adjust the spacing between elements */
        margin-right: 5%; /* Optional: Add some margin to the right of each element */
    }

    .custom-radio {
        display: inline-block;
        background-color: black;
        color: white;
        padding: 8px 16px;
        margin-right: 8px;
        margin-bottom: 8px;
        border-radius: 4px;
        cursor: pointer;
        user-select: none;
    }

    .custom-radio.disabled {
        background-color: gray;
        cursor: not-allowed;
    }

    .custom-radio.selected {
        background-color: #2b800f;
    }

</style>

<script>
    // call the function on page load

    function toggleSubmitButton() {
        let termsCheckbox = document.getElementById("terms_accepted");
        let time1Radios = document.getElementsByName("appointment[time]");
        let timeSelected = Array.from(time1Radios).some(radio => radio.checked);
        let submitButton = document.querySelector("input[type='submit']");
        submitButton.disabled = !(termsCheckbox.checked && timeSelected);
    }

    document.addEventListener("DOMContentLoaded", () => {
        toggleSubmitButton();
        let termsCheckbox = document.getElementById("terms_accepted");
        termsCheckbox.addEventListener("change", toggleSubmitButton);
    });

    function disableSelectedTime(clickedRadioButton) {
        let radioButtons = document.querySelectorAll("input[name='appointment[time]']");
        radioButtons.forEach(function (radioButton) {
            if (radioButton !== clickedRadioButton) {
                radioButton.checked = false;
            }
        });

        let labels = document.querySelectorAll(".custom-radio");
        labels.forEach(function (label) {
            if (label.getAttribute("for") === clickedRadioButton.id) {
                label.classList.add("selected");
            } else {
                label.classList.remove("selected");
            }
        });
    }


</script>
